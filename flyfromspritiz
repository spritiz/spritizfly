-- FlyScript.lua
-- Made by Spritiz | For Educational Purposes Only
-- Controls: C toggle, Q up, E down
-- Place this in StarterPlayer -> StarterPlayerScripts

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local flying = false
local ascend = false
local descend = false
local flightObjects = nil
local guiLabel = nil

local speed = 80
local verticalSpeed = 60
local accel = 3000

-- Get the HumanoidRootPart
local function getHRP()
    local char = player.Character or player.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

-- Enable flight
local function enableFlight(hrp)
    local bv = Instance.new("BodyVelocity")
    bv.Name = "Flight_BodyVelocity"
    bv.MaxForce = Vector3.new(1e5,1e5,1e5)
    bv.P = accel
    bv.Velocity = Vector3.new()
    bv.Parent = hrp

    local bg = Instance.new("BodyGyro")
    bg.Name = "Flight_BodyGyro"
    bg.MaxTorque = Vector3.new(1e5,1e5,1e5)
    bg.P = 3000
    bg.CFrame = hrp.CFrame
    bg.Parent = hrp

    flightObjects = {bv = bv, bg = bg}
end

-- Disable flight
local function disableFlight()
    if flightObjects then
        if flightObjects.bv then flightObjects.bv:Destroy() end
        if flightObjects.bg then flightObjects.bg:Destroy() end
        flightObjects = nil
    end
end

-- Toggle flight
local function toggleFlight()
    flying = not flying
    if flying then
        enableFlight(getHRP())
        if guiLabel then
            guiLabel.Text = "Flight: ON (C toggle | Q up | E down)\nMade by Spritiz | Educational"
            guiLabel.TextColor3 = Color3.fromRGB(0,170,255)
        end
    else
        disableFlight()
        if guiLabel then
            guiLabel.Text = "Flight: OFF (C toggle | Q up | E down)\nMade by Spritiz | Educational"
            guiLabel.TextColor3 = Color3.fromRGB(0,100,200)
        end
    end
end

-- Create draggable GUI
local function createGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FlightControlsGui"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0, 380, 0, 60)
    label.Position = UDim2.new(0, 10, 0, 10)
    label.BackgroundTransparency = 0.2
    label.BackgroundColor3 = Color3.fromRGB(0, 50, 120)
    label.TextColor3 = Color3.fromRGB(0, 100, 200)
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 18
    label.Text = "Flight: OFF (C toggle | Q up | E down)\nMade by Spritiz | Educational"
    label.TextWrapped = true
    label.Active = true
    label.Draggable = true
    label.Parent = screenGui

    guiLabel = label
end

createGUI()

-- Input handling
UserInputService.InputBegan:Connect(function(inp, gp)
    if gp then return end
    if inp.KeyCode == Enum.KeyCode.C then
        toggleFlight()
    elseif inp.KeyCode == Enum.KeyCode.Q then
        ascend = true
    elseif inp.KeyCode == Enum.KeyCode.E then
        descend = true
    end
end)

UserInputService.InputEnded:Connect(function(inp)
    if inp.KeyCode == Enum.KeyCode.Q then
        ascend = false
    elseif inp.KeyCode == Enum.KeyCode.E then
        descend = false
    end
end)

-- Update loop
RunService.Heartbeat:Connect(function()
    if not flying or not flightObjects then return end
    local char = player.Character
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChildOfClass("Humanoid")
    if not hrp then return end

    local cam = camera.CFrame
    local forward = Vector3.new(cam.LookVector.X,0,cam.LookVector.Z).Unit
    local right = Vector3.new(cam.RightVector.X,0,cam.RightVector.Z).Unit

    local md = humanoid and humanoid.MoveDirection or Vector3.new()
    local horiz = (forward * md.Z + right * md.X) * speed

    local vert = 0
    if ascend then vert = verticalSpeed end
    if descend then vert = -verticalSpeed end

    local targetVel = Vector3.new(horiz.X, vert, horiz.Z)
    flightObjects.bv.Velocity = targetVel

    local faceDir = Vector3.new(cam.LookVector.X,0,cam.LookVector.Z)
    flightObjects.bg.CFrame = CFrame.new(hrp.Position, hrp.Position + faceDir)
end)

-- Cleanup on respawn
player.CharacterAdded:Connect(function()
    flying = false
    disableFlight()
    if guiLabel then
        guiLabel.Text = "Flight: OFF (C toggle | Q up | E down)\nMade by Spritiz | Educational"
        guiLabel.TextColor3 = Color3.fromRGB(0,100,200)
    end
end)
